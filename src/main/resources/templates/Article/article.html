<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/style/article.css">
    <title th:text="${article.title}">Article</title>
</head>
<body>
<div>
    <h1 class="HeaderTitle" th:text="${article.title}">Article</h1>
</div>
<nav class="navBar">
    <ul class="unorderedList">
        <li class="listItem"><a class="link" href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
        <li class="listItem"><a class="link" href="/profile">–ü—Ä–æ—Ñ–∏–ª—å</a></li>
    </ul>
</nav>
<main>
    <div class="article">
        <h1 class="h2" th:text="${article.title}">–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–∞—Ç—å–∏</h1>
        <div th:utext="${article.content}"></div>
        <div class="class">
            <div id="likeDislike">
                <button class="button-like" th:attr="onclick='handleLike(\'' + ${article.id} + '\')'">üëçüèª</button>
                <span id="likesCount" th:text="${article.getLikes()}">0</span>
                <button class="button-dislike" th:attr="onclick='handleDislike(\'' + ${article.id} + '\')'">üëéüèª</button>
                <span id="dislikesCount" th:text="${article.dislikes}">0</span>
            </div>
            <div class="date">
                <p>–î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏: <span id="publishDate" th:text="${#dates.format(article.publishDate, 'yyyy:MM:dd HH:mm')}">2023:08:30 14:30</span></p>
                <p>–ê–≤—Ç–æ—Ä:  <span th:text="${article.getAuthor().getSurname()}">–ò–≤–∞–Ω</span> <span th:text="${article.getAuthor().getUsername()}">–ò–≤–∞–Ω–æ–≤</span></p>
            </div>
        </div>
    </div>
    <div>
        <form id="commentForm" class="comment-meta">
            <label for="comment">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</label><br>
            <textarea class="comment-content" id="comment" name="comment" rows="4" cols="50" required></textarea><br>
            <input class="hover_button" type="submit" value="–û—Ç–ø—Ä–∞–≤–∏—Ç—å">
        </form>
    </div>
</main>
<script>
    function handleLike(articleID) {
        fetch(`/${articleID}/like`, {
            method: 'POST',
            credentials: 'include',
        })
            .then(response => response.text())
            .then(data => {
                if (data === 'Liked') {
                    const likesCount = document.getElementById('likesCount');
                    likesCount.textContent = parseInt(likesCount.textContent) + 1;
                } else if (data === 'AlreadyLiked') {
                    alert('–í—ã —É–∂–µ –ø–æ—Å—Ç–∞–≤–∏–ª–∏ –ª–∞–π–∫');
                }
                else if (data==='Swapped'){
                    const likesCount = document.getElementById('likesCount');
                    likesCount.textContent = parseInt(likesCount.textContent) + 1;
                    const dislikesCount = document.getElementById('dislikesCount');
                    dislikesCount.textContent = parseInt(dislikesCount.textContent) -1;
                }
            })
            .catch(error => {
                console.error('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞:', error);
            });
    }

    function handleDislike(articleID) {
        fetch(`/${articleID}/dislike`, {
            method: 'POST',
            credentials: 'include',
        })
            .then(response => response.text())
            .then(data => {
                if (data === 'Disliked') {
                    const dislikesCount = document.getElementById('dislikesCount');
                    dislikesCount.textContent = parseInt(dislikesCount.textContent) + 1;
                } else if (data === 'AlreadyDisliked') {
                    alert('–í—ã —É–∂–µ –ø–æ—Å—Ç–∞–≤–∏–ª–∏ –¥–∏–∑–ª–∞–π–∫');
                }
                else if (data==='Swapped'){
                    const likesCount = document.getElementById('likesCount');
                    likesCount.textContent = parseInt(likesCount.textContent) - 1;
                    const dislikesCount = document.getElementById('dislikesCount');
                    dislikesCount.textContent = parseInt(dislikesCount.textContent) + 1;
                }
            })
            .catch(error => {
                console.error('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞:', error);
            });
    }
</script>
</body>
</html>
